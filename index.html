<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Tidy API for Sequence Iteration and Set Comprehension • peruse</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="A Tidy API for Sequence Iteration and Set Comprehension">
<meta property="og:description" content="A friendly API for sequence iteration and set comprehension.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">peruse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Releases</li>
    <li>
      <a href="https://jacgoldsm.github.io/">peruse 0.2.0</a>
    </li>
    <li>
      <a href="https://jacgoldsm.github.io/">peruse 0.3.0</a>
    </li>
    <li class="divider">
    <li>
      <a href="news/index.html">Changelog</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jacgoldsm/peruse/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="peruse" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#peruse" class="anchor"></a>peruse</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>The {peruse} package is aimed at making it easier to generate irregular sequences that are difficult to generate with existing tools.</p>
<p>The heart of {peruse} is the <code>S3</code> class <code>Iterator</code>. An <code>Iterator</code> allows the user to write an arbitrary R expression that returns the next element of a sequence of R objects. It then saves the state of the <code>Iterator</code>, meaning the next time evaluation is invoked, the initial state will be the result of the previous iteration. This is most useful for generating recursive sequences, those where each iteration depends on previous ones.</p>
<p>The package also provides a simple, tidy API for set building, allowing the user to generate a set consisting of the elements of a vector that meet specific criteria. This can either return a vector consisting of all the chosen elements or it can return an <code>Iterator</code> that lazily generates the chosen elements.</p>
<p>At the end of this document, there is a tutorial for metaprogramming (that is, programmatically generating code) with <code>Iterator</code>s.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the released version of peruse from <a href="https://CRAN.R-project.org">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"peruse"</span><span class="op">)</span></code></pre></div>
<p>And the development version from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"jacgoldsm/peruse"</span><span class="op">)</span></code></pre></div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<div id="negative-binomial-investigation" class="section level3">
<h3 class="hasAnchor">
<a href="#negative-binomial-investigation" class="anchor"></a>Negative Binomial Investigation</h3>
<p>Suppose we want to investigate the question of how many trials it takes for a random walk with drift to reach a given threshold. We know that this would follow a Negative Binomial distribution, but how could we use the Iterator to look at this empirically in a way that easily allows us to adjust the drift term and see how the result changes? We might do something like this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p_success</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>
<span class="va">threshold</span> <span class="op">&lt;-</span> <span class="fl">100</span>


<span class="va">iter</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Iterator.html">Iterator</a></span><span class="op">(</span><span class="op">{</span>
          <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">seeds</span><span class="op">[</span><span class="va">.iter</span><span class="op">]</span><span class="op">)</span>
          <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">p_success</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">p_success</span><span class="op">)</span><span class="op">)</span>
        <span class="op">}</span>,
        <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">0</span>, seeds <span class="op">=</span> <span class="fl">1000</span><span class="op">:</span><span class="fl">1e5</span><span class="op">)</span>, 
        <span class="va">n</span><span class="op">)</span>
<span class="va">sequence</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/yield_while.html">yield_while</a></span><span class="op">(</span><span class="va">iter</span>, <span class="va">n</span> <span class="op">&lt;=</span> <span class="va">threshold</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sequence</span>, main <span class="op">=</span> <span class="st">"How many iterations does it take to get to 100?"</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-2-1.png" width="100%"></p>
<p>How would we apply this same function to a grid of probabilities? We could do something like this:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.95</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>
<span class="va">num_iter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span><span class="op">)</span>
<span class="va">threshold</span> <span class="op">&lt;-</span> <span class="fl">20</span>
<span class="va">seeds</span> <span class="op">&lt;-</span> <span class="fl">1000</span><span class="op">:</span><span class="fl">1e6</span>


<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">iter</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Iterator.html">Iterator</a></span><span class="op">(</span><span class="op">{</span>
           <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">seeds</span><span class="op">[</span><span class="va">.iter</span><span class="op">]</span><span class="op">)</span>
           <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span> <span class="va">probs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">1</span> <span class="op">-</span> <span class="op">!</span><span class="op">!</span> <span class="va">probs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
          <span class="op">}</span>, 
          <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
          yield <span class="op">=</span> <span class="va">n</span><span class="op">)</span>
  
  <span class="va">num_iter</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="reference/yield_while.html">yield_while</a></span><span class="op">(</span><span class="va">iter</span>, <span class="va">n</span> <span class="op">&lt;=</span> <span class="va">threshold</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">probs</span>,
     y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">num_iter</span><span class="op">)</span>,
     main <span class="op">=</span> <span class="st">"Probability of Success vs How long it takes to get to 20 (Log Scale)"</span>,
     xlab <span class="op">=</span> <span class="st">"Probability of Success"</span>,
     ylab <span class="op">=</span> <span class="st">"Log Number of Iterations"</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-3-1.png" width="100%"></p>
<p>This illustrates a few useful features of Iterators:</p>
<ul>
<li><p>We can use environment variables in either our expression or our <code>while</code> condition to represent constants. In this case, <code>threshold</code> doesn’t change between iterations or between parameters. If you are creating many <code>Iterator</code>s, it can be faster to use environment variables, since you don’t have to make a new object for each new <code>Iterator</code>.</p></li>
<li><p>We can use the forcing operators from <a href="https://rlang.r-lib.org">rlang</a> (<code>!!</code>) to force evaluation of arguments in place, in this case substituting the <em>expression</em> of <code>probs[i]</code> with the <em>value</em> of <code>probs[i]</code> (see the end of this document for a tutorial on metaprogramming with <code>Iterator</code>s).</p></li>
<li><p>We can refer to the current iteration number in <code><a href="reference/yield_while.html">yield_while()</a></code>, <code><a href="reference/yield.html">yield_more()</a></code>, or their silent variants with the variable <code>.iter</code>.</p></li>
</ul>
</div>
<div id="collatz-sequence" class="section level3">
<h3 class="hasAnchor">
<a href="#collatz-sequence" class="anchor"></a>Collatz Sequence</h3>
<p>A Collatz sequence is a particular sequence of natural numbers that mathematicians think always reaches 1 at some point, no matter the starting point. We can’t prove that one way or the other, but we can create an <code>Iterator</code> that lazily generates a Collatz sequence until it reaches 1:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jacgoldsm/peruse">peruse</a></span><span class="op">)</span>
  
<span class="co"># Collatz generator starting at 50</span>
<span class="va">collatz</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Iterator.html">Iterator</a></span><span class="op">(</span><span class="op">{</span>
             <span class="kw">if</span> <span class="op">(</span><span class="va">n</span> <span class="op">%%</span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">2</span> <span class="kw">else</span> <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">*</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">1</span>
           <span class="op">}</span>,
           initial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,
           yield <span class="op">=</span> <span class="va">n</span><span class="op">)</span>

<span class="fu"><a href="reference/yield_while.html">yield_while</a></span><span class="op">(</span><span class="va">collatz</span>, <span class="va">n</span> <span class="op">!=</span> <span class="fl">1L</span><span class="op">)</span>
<span class="co">#&gt;  [1] 25 76 38 19 58 29 88 44 22 11 34 17 52 26 13 40 20 10  5 16  8  4  2  1</span></code></pre></div>
</div>
<div id="random-walk-with-drift" class="section level3">
<h3 class="hasAnchor">
<a href="#random-walk-with-drift" class="anchor"></a>Random Walk with Drift</h3>
<p>Random Walks, with or without drift, are one of the most commonly used type of stochastic processes. How can we simulate one with {peruse}?</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rwd</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Iterator.html">Iterator</a></span><span class="op">(</span><span class="op">{</span>
         <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1L</span>, <span class="fl">1L</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1L</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span>
       <span class="op">}</span>,
       initial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
       yield <span class="op">=</span> <span class="va">n</span><span class="op">)</span>


<span class="va">Value</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/yield_while.html">yield_while</a></span><span class="op">(</span><span class="va">rwd</span>, <span class="va">n</span> <span class="op">!=</span> <span class="fl">50L</span> <span class="op">&amp;</span> <span class="va">n</span> <span class="op">!=</span> <span class="op">-</span><span class="fl">50L</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Value</span>, main <span class="op">=</span> <span class="st">"The Value of the Iterator after a Given Number of Iterations"</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-4-1.png" width="100%"></p>
<p>Here, we can see that <code>seq</code> gets to <code>50</code> after about <code>100</code> iterations when it is weighted <code>3:1</code> odds in favor of adding <code>1</code> over adding <code>-1</code> to the prior value.</p>
</div>
</div>
<div id="a-note" class="section level2">
<h2 class="hasAnchor">
<a href="#a-note" class="anchor"></a>A Note</h2>
<p>Helper functions <code><a href="reference/yield.html">yield_more()</a></code>, <code><a href="reference/yield_while.html">yield_while()</a></code>, <code><a href="reference/move.html">move_more()</a></code>, and <code><a href="reference/move.html">move_while()</a></code> behave mostly like syntactic sugar for explicit loops. So,</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">it</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Iterator.html">Iterator</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">1L</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="va">x</span><span class="op">)</span>
<span class="va">it2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/clone.html">clone</a></span><span class="op">(</span><span class="va">it</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/yield.html">yield_next</a></span><span class="op">(</span><span class="va">it</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>will give the same result as</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/yield.html">yield_more</a></span><span class="op">(</span><span class="va">it2</span>, <span class="fl">100</span><span class="op">)</span></code></pre></div>
<p>However, doing it the latter way is significantly more efficient than the former. This is because a lot of the overhead only needs to be done once per call to <code>yield</code>. That means that a lot less has to be done on every iteration when you explicitly call <code><a href="reference/yield.html">yield_more()</a></code>.</p>
<p>This is even more true with <code><a href="reference/yield_while.html">yield_while()</a></code>. Pretend we don’t know how long this <code>Iterator</code> will take to reach 10,000. Doing something like:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">while</span> <span class="op">(</span><span class="va">it</span><span class="op">$</span><span class="va">initial</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">10000</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="reference/yield.html">yield_next</a></span><span class="op">(</span><span class="va">it</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>is very inefficient because it requires reallocating the vector on every iteration. On the other hand, the following is both easier to read and much more efficient:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/yield_while.html">yield_while</a></span><span class="op">(</span><span class="va">it2</span>, <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">10000</span><span class="op">)</span></code></pre></div>
<p>Internally, <code><a href="reference/yield_while.html">yield_while()</a></code> uses an efficient algorithm for resizing the result in linear amortized time. As a result, it will evaluate much faster.</p>
<div id="primes" class="section level3">
<h3 class="hasAnchor">
<a href="#primes" class="anchor"></a>Primes</h3>
<p>How about generating all the prime numbers between <code>1</code> and <code>100</code>? We can easily do that with the set-builder API:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fl">2</span><span class="op">:</span><span class="fl">100</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/sets.html">that_for_all</a></span><span class="op">(</span><span class="fu"><a href="reference/range.html">range</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/sets.html">we_have</a></span><span class="op">(</span><span class="op">~</span><span class="va">.x</span> <span class="op">%%</span> <span class="va">.y</span><span class="op">)</span>
<span class="co">#&gt;  [1]  2  3  5  7 11 13 17 19 23 29 31 37 41 43 47 53 59 61 67 71 73 79 83 89 97</span></code></pre></div>
<p>In the equation, we can reference the left-hand side of the equation with the positional variable <code>.x</code>, and the right-hand side (that is, the argument in <code><a href="reference/sets.html">that_for_all()</a></code>) with <code>.y</code>. The equation can be anything recognized as a function by <code><a href="https://rlang.r-lib.org/reference/as_function.html">rlang::as_function()</a></code>.</p>
<p>But how about if we want to generate the first 100 prime numbers? We don’t know the range of values this should fall in (well, mathematicians do), so we can use laziness to our advantage:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">primes</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">:</span><span class="fl">10000</span> <span class="op">%&gt;%</span>
            <span class="fu"><a href="reference/sets.html">that_for_all</a></span><span class="op">(</span><span class="fu"><a href="reference/range.html">range</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
            <span class="fu"><a href="reference/sets.html">we_have</a></span><span class="op">(</span><span class="op">~</span><span class="va">.x</span> <span class="op">%%</span> <span class="va">.y</span>, <span class="st">"Iterator"</span><span class="op">)</span>

<span class="va">primes_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/clone.html">clone</a></span><span class="op">(</span><span class="va">primes</span><span class="op">)</span></code></pre></div>
<p>The first prime number is</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/yield.html">yield_next</a></span><span class="op">(</span><span class="va">primes_2</span><span class="op">)</span>
<span class="co">#&gt; [1] 2</span></code></pre></div>
<p>And the first 100 are:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sequence</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/yield.html">yield_more</a></span><span class="op">(</span><span class="va">primes</span>, <span class="fl">100</span><span class="op">)</span>
<span class="va">sequence</span>
<span class="co">#&gt;   [1]   2   3   5   7  11  13  17  19  23  29  31  37  41  43  47  53  59  61</span>
<span class="co">#&gt;  [19]  67  71  73  79  83  89  97 101 103 107 109 113 127 131 137 139 149 151</span>
<span class="co">#&gt;  [37] 157 163 167 173 179 181 191 193 197 199 211 223 227 229 233 239 241 251</span>
<span class="co">#&gt;  [55] 257 263 269 271 277 281 283 293 307 311 313 317 331 337 347 349 353 359</span>
<span class="co">#&gt;  [73] 367 373 379 383 389 397 401 409 419 421 431 433 439 443 449 457 461 463</span>
<span class="co">#&gt;  [91] 467 479 487 491 499 503 509 521 523 541</span></code></pre></div>
<p>Here, we use <code><a href="reference/clone.html">clone()</a></code> to create an identical <code>Iterator</code> to <code>primes</code> that can be modified separately.</p>
<p><code><a href="reference/clone.html">clone()</a></code> also carries optional arguments that override the <code>$initial</code> parameters in the old <code>Iterator</code>. For example,</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">it</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Iterator.html">Iterator</a></span><span class="op">(</span><span class="op">{</span><span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">+</span> <span class="va">n</span><span class="op">}</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>m <span class="op">=</span> <span class="fl">0</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">m</span><span class="op">)</span>
<span class="va">it2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/clone.html">clone</a></span><span class="op">(</span><span class="va">it</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="reference/yield.html">yield_next</a></span><span class="op">(</span><span class="va">it</span><span class="op">)</span>
<span class="co">#&gt; [1] 1</span>
<span class="fu"><a href="reference/yield.html">yield_next</a></span><span class="op">(</span><span class="va">it2</span><span class="op">)</span>
<span class="co">#&gt; [1] 5</span></code></pre></div>
<p>Here, we overrode <code>n = 1</code> in <code>it</code> with <code>n = 5</code> in <code>it2</code>.</p>
</div>
</div>
<div id="set-utilities" class="section level2">
<h2 class="hasAnchor">
<a href="#set-utilities" class="anchor"></a>Set Utilities</h2>
<p><code>Iterator</code>s that are created from set comprehension have several utilities:</p>
<ul>
<li><p>Refer to the vector <code>.x</code> with the variable <code>.x_vector</code></p></li>
<li><p>Refer to the current index of <code>.x_vector</code> with <code>.i</code> (not to be confused with <code>.iter</code>).</p></li>
</ul>
<p>Here is an example of putting those together to yield to the end of the sequence:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">primes_100</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">:</span><span class="fl">100</span> <span class="op">%&gt;%</span> 
              <span class="fu"><a href="reference/sets.html">that_for_all</a></span><span class="op">(</span><span class="fu"><a href="reference/range.html">range</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
              <span class="fu"><a href="reference/sets.html">we_have</a></span><span class="op">(</span><span class="op">~</span><span class="va">.x</span> <span class="op">%%</span> <span class="va">.y</span>, <span class="st">"Iterator"</span><span class="op">)</span>

<span class="fu"><a href="reference/yield_while.html">yield_while</a></span><span class="op">(</span><span class="va">primes_100</span>, <span class="va">.x_vector</span><span class="op">[</span><span class="va">.i</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="fl">100</span><span class="op">)</span>
<span class="co">#&gt; (Note: result has reached end of sequence)</span>
<span class="co">#&gt;  [1]  2  3  5  7 11 13 17 19 23 29 31 37 41 43 47 53 59 61 67 71 73 79 83 89 97</span></code></pre></div>
<p>As you can see, the sequence terminates with a message that the end has been reached.</p>
<p>In reality, the sequence will terminate at the end anyway, so you can generate the whole sequence like this:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">primes_100</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">:</span><span class="fl">100</span> <span class="op">%&gt;%</span> 
              <span class="fu"><a href="reference/sets.html">that_for_all</a></span><span class="op">(</span><span class="fu"><a href="reference/range.html">range</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
              <span class="fu"><a href="reference/sets.html">we_have</a></span><span class="op">(</span><span class="op">~</span><span class="va">.x</span> <span class="op">%%</span> <span class="va">.y</span>, <span class="st">"Iterator"</span><span class="op">)</span>

<span class="fu"><a href="reference/yield_while.html">yield_while</a></span><span class="op">(</span><span class="va">primes_100</span>, <span class="cn">T</span><span class="op">)</span>
<span class="co">#&gt; (Note: result has reached end of sequence)</span>
<span class="co">#&gt;  [1]  2  3  5  7 11 13 17 19 23 29 31 37 41 43 47 53 59 61 67 71 73 79 83 89 97</span></code></pre></div>
<div id="missing-values" class="section level3">
<h3 class="hasAnchor">
<a href="#missing-values" class="anchor"></a>Missing Values</h3>
<p>Set comprehension does not specially handle missing values. All the elements of set <code>.x</code> will be compared with all the elements of set <code>.y</code> by <code>formula</code>, and the value of <code>.x</code> will be included if and only if the condition returns <code>TRUE</code>. If the comparison returns <code>NA</code>, the expression will terminate with an error.</p>
<p>Be aware of two things: First, expressions like <code>NA == NA</code>, <code>NA &gt; NA</code>, and <code>NA &lt;= NA</code> return <code>NA</code>. Second, expressions of the form <code>if (NA) action</code> are illegal and will result in an error.</p>
<p>As a result, an expression like this will not work:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">20</span>, <span class="cn">NA_integer_</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/sets.html">that_for_all</a></span><span class="op">(</span><span class="fu"><a href="reference/range.html">range</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/sets.html">we_have</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.x</span> <span class="op">%%</span> <span class="va">.y</span><span class="op">)</span></code></pre></div>
<p>In fact, this will fail for two reasons: <code><a href="reference/range.html">range(2, .x)</a></code> will not work when <code>.x</code> is <code>NA</code>, and the comparison <code>if (NA %% 2)</code> will also not work.</p>
<p>Normally, you will want to drop <code>NA</code> values from your vectors before using set comprehension. If you are careful, you can write valid code with <code>NA</code>s, but it will be very painful by comparison:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">20</span>, <span class="cn">NA_integer_</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/sets.html">that_for_all</a></span><span class="op">(</span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="cn">NA</span> <span class="kw">else</span> <span class="fu"><a href="reference/range.html">range</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/sets.html">we_have</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="op">||</span> <span class="va">.x</span> <span class="op">%%</span> <span class="va">.y</span><span class="op">)</span>
<span class="co">#&gt; [1]  2  3  5  7 11 13 17 19 NA</span></code></pre></div>
<p>Here, we avoid <code><a href="reference/range.html">range(2, NA)</a></code> with our conditional, and avoid having <code>NA</code> in the <code>if</code> statement in <code><a href="reference/sets.html">we_have()</a></code> by making sure to return <code>TRUE</code> when <code>.x</code> is missing.</p>
</div>
</div>
</div>
<div id="tutorial-metaprogramming-with-iterators" class="section level1">
<h1 class="hasAnchor">
<a href="#tutorial-metaprogramming-with-iterators" class="anchor"></a>Tutorial: Metaprogramming with <code>Iterator</code>s</h1>
<p><code>Iterator</code>s are designed to be flexible, almost as flexible as ordinary R functions. They are also designed to be tidy, using tools from the “tidyverse” family of R extensions. Unfortunately, those goals are not entirely compatible when it comes to metaprogramming, leading to a sort of “semi-tidy” evaluation. Use these examples as a reference for programmatically generating <code>Iterator</code> expressions.</p>
<p>In almost all cases, the environment in which an Iterator is made does not effect its execution; rather, the environment from which <code><a href="reference/yield.html">yield_next()</a></code> or its cousins is called determines evaluation. In this way, it is similar to ordinary R functions. The one small exception will be detailed at the end.</p>
<div id="forcing" class="section level3">
<h3 class="hasAnchor">
<a href="#forcing" class="anchor"></a>Forcing</h3>
<p>Use <code>!!</code> to force evaluation of names, just like you would in <code>dplyr</code> or any Tidyverse function:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>
<span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Iterator.html">Iterator</a></span><span class="op">(</span><span class="op">{</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="op">!</span><span class="op">!</span> <span class="va">p</span><span class="op">}</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="va">x</span><span class="op">)</span>
<span class="fu"><a href="reference/yield.html">yield_more</a></span><span class="op">(</span><span class="va">i</span>, <span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.5 1.0 1.5 2.0 2.5</span></code></pre></div>
<p>There is no built-in mechanism to force evaluation of names in the <code>$initial</code> list, but you can use tools like <code><a href="https://rlang.r-lib.org/reference/list2.html">rlang::list2()</a></code> to do so. <code>$initial</code> can be anything coercible to list.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">0.1</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/name.html">as.symbol</a></span><span class="op">(</span><span class="st">"my_var"</span><span class="op">)</span>
<span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/Iterator.html">Iterator</a></span><span class="op">(</span><span class="op">{</span><span class="op">!</span><span class="op">!</span> <span class="va">x</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="op">!</span> <span class="va">x</span> <span class="op">+</span> <span class="op">!</span><span class="op">!</span> <span class="va">p</span><span class="op">}</span>, <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/list2.html">list2</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span> <span class="va">x</span> <span class="op">:=</span> <span class="fl">0</span><span class="op">)</span>, <span class="op">!</span><span class="op">!</span> <span class="va">x</span><span class="op">)</span>
<span class="fu"><a href="reference/yield.html">yield_more</a></span><span class="op">(</span><span class="va">i</span>, <span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.1 0.2 0.3 0.4 0.5</span></code></pre></div>
<p>Note the use of the “walrus” operator (<code>:=</code>) to assign names in <code><a href="https://rlang.r-lib.org/reference/list2.html">rlang::list2()</a></code>, see the documentation in <code>rlang::nse-force()</code> for more details.</p>
</div>
<div id="force-defuse" class="section level3">
<h3 class="hasAnchor">
<a href="#force-defuse" class="anchor"></a>Force-defuse</h3>
<p>Since <code>Iterator</code>s don’t use quosures (because they work independently of the environment where they are created), you can’t use <code>{{ }}</code> to force-defuse expressions. Use <code>!! substitute()</code> instead:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">make_random_walk_with_drift</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">drift</span>, <span class="va">variable</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="reference/Iterator.html">Iterator</a></span><span class="op">(</span><span class="op">{</span><span class="op">!</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">(</span>
    <span class="op">!</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, 
                                     <span class="fl">1</span>,
                                     <span class="cn">TRUE</span>,
                                     <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op">(</span><span class="va">drift</span><span class="op">)</span>, <span class="fl">1</span> <span class="op">-</span> <span class="op">!</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op">(</span><span class="va">drift</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
                                <span class="op">)</span><span class="op">}</span>,
           initial <span class="op">=</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/list2.html">list2</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span> <span class="op">:=</span> <span class="fl">0</span><span class="op">)</span>, <span class="op">!</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="reference/yield.html">yield_more</a></span><span class="op">(</span><span class="fu">make_random_walk_with_drift</span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">x</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt; [1]  1  2  1  0 -1</span></code></pre></div>
</div>
<div id="indirection" class="section level3">
<h3 class="hasAnchor">
<a href="#indirection" class="anchor"></a>Indirection</h3>
<p>Since <code>Iterator</code>s don’t use data masks, they don’t have <code>.data</code> and <code>.env</code> pronouns. If you have a variable in <code>iter$initial</code> and a variable with the same name in your global environment, just force immediate evaluation of the environment variable with <code>!!</code>.</p>
</div>
<div id="one-exception" class="section level3">
<h3 class="hasAnchor">
<a href="#one-exception" class="anchor"></a>One Exception</h3>
<p>Ordinarily, <code>Iterator</code>s work independently from the environment in which they were created. The one exception is when an <code>Iterator</code> is created from the template,</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iterator</span> <span class="op">&lt;-</span> <span class="va">.x</span> <span class="op">%&gt;%</span> <span class="va">expression_with_.x</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/sets.html">we_have</a></span><span class="op">(</span><span class="va">formula</span>, <span class="st">"Iterator"</span><span class="op">)</span></code></pre></div>
<p>the variable <code>expression_with_.x</code> is turned into a quosure. That means that it will always be evaluated in the environment where <code>iterator</code> was made.</p>
<p>For a concrete example, consider:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">offset</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">it</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">:</span><span class="fl">100</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/sets.html">that_for_all</a></span><span class="op">(</span><span class="fu"><a href="reference/range.html">range</a></span><span class="op">(</span><span class="va">offset</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/sets.html">we_have</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.x</span> <span class="op">%%</span> <span class="va">.y</span>, <span class="st">"Iterator"</span><span class="op">)</span>
 <span class="va">fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">offset</span> <span class="op">&lt;-</span> <span class="fl">3</span>
  <span class="fu"><a href="reference/yield_while.html">yield_while</a></span><span class="op">(</span><span class="va">it</span>, <span class="op">!</span><span class="va">.finished</span><span class="op">)</span> <span class="co"># print the whole sequence</span>
 <span class="op">}</span>
 
 <span class="fu">fun</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; (Note: result has reached end of sequence)</span>
<span class="co">#&gt;  [1]  2  3  5  7 11 13 17 19 23 29 31 37 41 43 47 53 59 61 67 71 73 79 83 89 97</span></code></pre></div>
<p>We can see that the code does not select elements that are divisible by 2 but not any other numbers, as would be the case with offset equal to three. Our expression <code><a href="reference/range.html">range(offset, .x)</a></code> is evaluated in the global environment, not in the execution environment of <code>fun()</code>.</p>
</div>
</div>
<div id="citation" class="section level1">
<h1 class="hasAnchor">
<a href="#citation" class="anchor"></a>Citation</h1>
<p>This software contains a modified version of a small piece of code from the <code>purrr</code> package, by Hadley Wickham, Lionel Henry, and RStudio, freely available under the MIT License.</p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=peruse">https://​cloud.r-project.org/​package=peruse</a>
</li>
<li>Browse source code at <br><a href="https://github.com/jacgoldsm/peruse/">https://​github.com/​jacgoldsm/​peruse/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/jacgoldsm/peruse/issues">https://​github.com/​jacgoldsm/​peruse/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Jacob Goldsmith <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Jacob Goldsmith.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
